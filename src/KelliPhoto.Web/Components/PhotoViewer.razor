@using KelliPhoto.Web.Data.Models
@inject IPhotoService PhotoService
@inject NavigationManager Navigation

@if (Photo != null)
{
    <div class="photo-viewer">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <button class="btn btn-secondary" @onclick="GoBack">
                <i class="bi bi-arrow-left"></i> Back
            </button>
            <h4>@Photo.Filename</h4>
            <div></div>
        </div>

        <div class="text-center">
            <img src="/api/images/photo/@Photo.Id" 
                 alt="@Photo.Filename" 
                 class="img-fluid"
                 style="max-height: 80vh; max-width: 100%;" />
        </div>

        @if (Photo.Width.HasValue && Photo.Height.HasValue)
        {
            <div class="mt-3 text-center text-muted">
                <small>@Photo.Width x @Photo.Height pixels</small>
                @if (Photo.TakenAt.HasValue)
                {
                    <small> | Taken: @Photo.TakenAt.Value.ToString("yyyy-MM-dd HH:mm")</small>
                }
            </div>
        }
    </div>
}
else
{
    <div class="text-center">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
}

@code {
    [Parameter] public int PhotoId { get; set; }

    private Photo? Photo { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await LoadPhotoAsync();
    }

    protected override async Task OnParametersSetAsync()
    {
        await LoadPhotoAsync();
    }

    private async Task LoadPhotoAsync()
    {
        Photo = await PhotoService.GetPhotoByIdAsync(PhotoId);
    }

    private void GoBack()
    {
        if (Photo?.FolderId != null)
        {
            Navigation.NavigateTo($"/gallery/{Photo.FolderId}");
        }
        else
        {
            Navigation.NavigateTo("/gallery");
        }
    }
}
